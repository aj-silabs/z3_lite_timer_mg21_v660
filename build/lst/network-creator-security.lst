###############################################################################
#
# IAR ANSI C/C++ Compiler V8.32.2.178/W32 for ARM         14/Jun/2019  13:19:25
# Copyright 1999-2018 IAR Systems AB.
#
#    Cpu mode     =  
#    Endian       =  little
#    Source file  =  
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.6\protocol\zigbee\app\framework\plugin\network-creator-security\network-creator-security.c
#    Command line =  
#        -f C:\Users\alji\AppData\Local\Temp\EWD4CB.tmp
#        (C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.6\protocol\zigbee\app\framework\plugin\network-creator-security\network-creator-security.c
#        -D LOCAL_STORAGE_BTL -D CORTEXM3 -D CORTEXM3_EFR32 -D
#        CORTEXM3_EFR32_MICRO -D CORTEXM3_EFM32_MICRO -D
#        EFR32_SERIES2_CONFIG1_MICRO -D EFR32MG21 -D EFR32MG21A010F1024IM32 -D
#        "ATTRIBUTE_STORAGE_CONFIGURATION=\"z3_lite_timer_mg21_v660_endpoint_config.h\""
#        -D "CONFIGURATION_HEADER=\"app/framework/util/config.h\"" -D
#        "GENERATED_TOKEN_HEADER=\"z3_lite_timer_mg21_v660_tokens.h\"" -D
#        "PLATFORM_HEADER=\"platform/base/hal/micro/cortexm3/compiler/iar.h\""
#        -D "ZA_GENERATED_HEADER=\"z3_lite_timer_mg21_v660.h\"" -D
#        "__SOURCEFILE__=\"network-creator-security.c\"" -D PSSTORE_SIZE=0 -D
#        LONGTOKEN_SIZE=0 -D LOCKBITS_IN_MAINFLASH_SIZE=8192 -D HAL_CONFIG=1 -D
#        EMBER_AF_USE_HWCONF -D LED_BLINK_PERIOD_MS=1000 -D NO_LED=1 -D
#        "EMBER_AF_API_EMBER_TYPES=\"stack/include/ember-types.h\"" -D
#        "EMBER_AF_API_DEBUG_PRINT=\"app/framework/util/print.h\"" -D
#        "EMBER_AF_API_AF_HEADER=\"app/framework/include/af.h\"" -D
#        "EMBER_AF_API_AF_SECURITY_HEADER=\"app/framework/security/af-security.h\""
#        -D EMBER_STACK_ZIGBEE -D
#        "MBEDTLS_CONFIG_FILE=\"mbedtls-config-generated.h\"" -D USE_NVM3 -D
#        NVM3_DEFAULT_NVM_SIZE=NVM3_FLASH_PAGES*FLASH_PAGE_SIZE -D
#        EMLIB_USER_CONFIG -D HAL_BULBPWM_ENABLE=1 -D
#        HAL_BULBPWM_FREQUENCY=1000 -D
#        "APPLICATION_TOKEN_HEADER=\"znet-token.h\"" -D
#        "APPLICATION_MFG_TOKEN_HEADER=\"znet-mfg-token.h\"" -D
#        "MBEDTLS_DEVICE_ACCELERATION_CONFIG_FILE=\"configs/config-device-acceleration.h\""
#        -D
#        "MBEDTLS_DEVICE_ACCELERATION_CONFIG_APP_FILE=\"config-device-acceleration-app.h\""
#        -D NVM3_FLASH_PAGES=4 -D NVM3_DEFAULT_CACHE_SIZE=200 -D
#        NVM3_MAX_OBJECT_SIZE=254 -D NVM3_DEFAULT_REPACK_HEADROOM=0 -D
#        PHY_RAIL=1 -lC
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\build\lst
#        --diag_suppress Pa050 -o
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\build\obj
#        --no_unroll --no_clustering --debug --endian=little
#        --cpu=Cortex-M33.no_dsp --cmse --no_path_in_file_macros
#        --separate_cluster_for_initialized_variables -e --fpu=None
#        --dlib_config "C:\Program Files (x86)\IAR Systems\Embedded Workbench
#        8.2\arm\inc\c\DLib_Config_Normal.h" -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.6\protocol\zigbee\app\framework\plugin\network-creator-security\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\protocol\zigbee\app\framework\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\protocol\zigbee\app\framework\..\..\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\protocol\zigbee\app\framework\..\..\stack\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\protocol\zigbee\app\framework\..\util\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\protocol\zigbee\app\framework\include\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\plugin\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\micro\cortexm3\efm32\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\micro\cortexm3\efm32\config\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\micro\cortexm3\efm32\efr32\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\CMSIS\Include\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\Device\SiliconLabs\efr32mg21\Include\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\common\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\config\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\dmadrv\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\gpiointerrupt\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\rtcdrv\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\sleep\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\spidrv\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\tempdrv\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\uartdrv\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\ustimer\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emlib\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\middleware\glib\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\middleware\glib\glib\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\radio\rail_lib\plugin\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\radio\rail_lib\chip\efr32\rf\common\cortex\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\radio\rail_lib\chip\efr32\rf\rfprotocol\ieee802154\cortex\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\halconfig\inc\hal-config\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\hardware\module\config\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\hardware\kit\common\halconfig\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\hardware\kit\common\bsp\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\hal-config\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\bootloader\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\emdrv\nvm3\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\chip\efr32\efr32xg2x\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\common\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\plugin\coexistence\common\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\plugin\coexistence\hal\efr32\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\plugin\coexistence\protocol\ieee802154\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\protocol\ble\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\protocol\ieee802154\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\protocol\zwave\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\util\plugin\plugin-common\mbedtls\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\util\third_party\mbedtls\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\util\third_party\mbedtls\include\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\util\third_party\mbedtls\include\mbedtls\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\util\third_party\mbedtls\sl_crypto\include\
#        -Ohz --use_c++_inline)
#    Locale       =  C
#    List file    =  
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\build\lst\network-creator-security.lst
#    Object file  =  
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\build\obj\network-creator-security.o
#
###############################################################################

C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.6\protocol\zigbee\app\framework\plugin\network-creator-security\network-creator-security.c
      1          /***************************************************************************//**
      2           * @file
      3           * @brief Routines for the Network Creator Security plugin, which configures
      4           *        network permit join state and key policy for a Zigbee 3.0 network.
      5           *******************************************************************************
      6           * # License
      7           * <b>Copyright 2018 Silicon Laboratories Inc. www.silabs.com</b>
      8           *******************************************************************************
      9           *
     10           * The licensor of this software is Silicon Laboratories Inc. Your use of this
     11           * software is governed by the terms of Silicon Labs Master Software License
     12           * Agreement (MSLA) available at
     13           * www.silabs.com/about-us/legal/master-software-license-agreement. This
     14           * software is distributed to you in Source Code format and is governed by the
     15           * sections of the MSLA applicable to Source Code.
     16           *
     17           ******************************************************************************/
     18          
     19          #include "app/framework/include/af.h"
     20          #include "app/framework/util/af-main.h"
     21          
     22          #include "network-creator-security.h"
     23          
     24          #include "app/framework/security/af-security.h" // emAfAllowTrustCenterRejoins
     25          #include "app/util/zigbee-framework/zigbee-device-common.h" // emberLeaveRequest
     26          
     27          #ifdef EZSP_HOST
     28          // NCP
     29            #define addTransientLinkKey        ezspAddTransientLinkKey
     30            #define setInitialSecurityState    ezspSetInitialSecurityState
     31            #define clearTransientLinkKeys     ezspClearTransientLinkKeys
     32            #define lookupNodeIdByEui64        ezspLookupNodeIdByEui64
     33          
     34            #define allowTrustCenterLinkKeyRequests() \
     35            ezspSetPolicy(EZSP_TC_KEY_REQUEST_POLICY, EZSP_ALLOW_TC_KEY_REQUESTS_AND_SEND_CURRENT_KEY)
     36            #define allowTrustCenterLinkKeyRequestsAndGenerateNewKeys() \
     37            ezspSetPolicy(EZSP_TC_KEY_REQUEST_POLICY, EZSP_ALLOW_TC_KEY_REQUEST_AND_GENERATE_NEW_KEY)
     38            #define setTransientKeyTimeout(timeS) \
     39            ezspSetValue(EZSP_VALUE_TRANSIENT_KEY_TIMEOUT_S, 2, (uint8_t *)(&timeS));
     40            #define setTcRejoinsUsingWellKnownKeyAllowed(allow) \
     41            (void)ezspSetPolicy(EZSP_TC_REJOINS_USING_WELL_KNOWN_KEY_POLICY, (allow))
     42            #define setTcRejoinsUsingWellKnownKeyTimeout(timeout) \
     43            (void)ezspSetConfigurationValue(EZSP_CONFIG_TC_REJOINS_USING_WELL_KNOWN_KEY_TIMEOUT_S, (timeout))
     44          #else
     45          // SoC
     46          extern uint16_t emAllowTcRejoinsUsingWellKnownKeyTimeoutSec;
     47            #define addTransientLinkKey        emberAddTransientLinkKey
     48            #define clearTransientLinkKeys     emberClearTransientLinkKeys
     49            #define setInitialSecurityState    emberSetInitialSecurityState
     50            #define lookupNodeIdByEui64        emberLookupNodeIdByEui64
     51          
     52            #define allowTrustCenterLinkKeyRequests() \
     53            emberTrustCenterLinkKeyRequestPolicy = EMBER_ALLOW_TC_LINK_KEY_REQUEST_AND_SEND_CURRENT_KEY
     54            #define allowTrustCenterLinkKeyRequestsAndGenerateNewKeys() \
     55            emberTrustCenterLinkKeyRequestPolicy = EMBER_ALLOW_TC_LINK_KEY_REQUEST_AND_GENERATE_NEW_KEY
     56            #define setTransientKeyTimeout(timeS) \
     57            emberTransientKeyTimeoutS = (timeS)
     58            #define setTcRejoinsUsingWellKnownKeyAllowed(allow) \
     59            emberSetTcRejoinsUsingWellKnownKeyAllowed((allow))
     60            #define setTcRejoinsUsingWellKnownKeyTimeout(timeout) \
     61            emAllowTcRejoinsUsingWellKnownKeyTimeoutSec = (timeout)
     62          #endif
     63          
     64          #define ZIGBEE_3_CENTRALIZED_SECURITY_LINK_KEY         \
     65            {                                                    \
     66              { 0x5A, 0x69, 0x67, 0x42, 0x65, 0x65, 0x41, 0x6C,  \
     67                0x6C, 0x69, 0x61, 0x6E, 0x63, 0x65, 0x30, 0x39 } \
     68            }
     69          
     70          #define ZIGBEE_3_DISTRIBUTED_SECURITY_LINK_KEY         \
     71            {                                                    \
     72              { 0xD0, 0xD1, 0xD2, 0xD3, 0xD4, 0xD5, 0xD6, 0xD7,  \
     73                0xD8, 0xD9, 0xDA, 0xDB, 0xDC, 0xDD, 0xDE, 0xDF } \
     74            }
     75          
     76          #ifndef EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_NETWORK_OPEN_TIME_S
     77            #define EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_NETWORK_OPEN_TIME_S (300)
     78          #endif
     79          
     80          #define NETWORK_OPEN_TIME_S (EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_NETWORK_OPEN_TIME_S)
     81          
     82          #if defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_ALLOW_HA_DEVICES_TO_STAY)
     83            #define ALLOW_HA_DEVICES true
     84          #else
     85            #define ALLOW_HA_DEVICES false
     86          #endif
     87          
     88          // -----------------------------------------------------------------------------
     89          // Globals
     90          

   \                                 In section .data, align 1
     91          bool allowHaDevices = ALLOW_HA_DEVICES;
   \                     allowHaDevices:
   \        0x0   0x01               DC8 1

   \                                 In section .data, align 4
     92          EmberKeyData distributedKey = ZIGBEE_3_DISTRIBUTED_SECURITY_LINK_KEY;
   \                     distributedKey:
   \        0x0   0xD0 0xD1          DC8 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220
   \              0xD2 0xD3    
   \              0xD4 0xD5    
   \              0xD6 0xD7    
   \              0xD8 0xD9    
   \              0xDA 0xDB    
   \              0xDC         
   \        0xD   0xDD 0xDE          DC8 221, 222, 223
   \              0xDF         
     93          
     94          // -----------------------------------------------------------------------------
     95          // Internal Declarations
     96          

   \                                 In section .bss, align 4
     97          EmberEventControl emberAfPluginNetworkCreatorSecurityOpenNetworkEventControl;
   \                     emberAfPluginNetworkCreatorSecurityOpenNetworkEventControl:
   \        0x0                      DS8 8
     98          #define openNetworkEventControl (emberAfPluginNetworkCreatorSecurityOpenNetworkEventControl)
     99          

   \                                 In section .bss, align 2
    100          static uint16_t openNetworkTimeRemainingS;
   \                     openNetworkTimeRemainingS:
   \        0x0                      DS8 2
    101          
    102          // -----------------------------------------------------------------------------
    103          // Framework Callbacks
    104          

   \                                 In section .text, align 2, keep-with-next
    105          void emberAfPluginNetworkCreatorSecurityInitCallback(void)
    106          {
    107          #if defined(EZSP_HOST) && defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_BDB_JOIN_USES_INSTALL_CODE_KEY)
    108            EzspStatus status = emberAfSetEzspPolicy(EZSP_TRUST_CENTER_POLICY,
    109                                                     EZSP_BDB_JOIN_USES_INSTALL_CODE_KEY,
    110                                                     "Trust Center Policy",
    111                                                     "Joins using install code only");
    112          
    113            if (EZSP_SUCCESS != status) {
    114              emberAfCorePrintln("%p: %p: 0x%X",
    115                                 EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_PLUGIN_NAME,
    116                                 "failed to configure joining using install code only",
    117                                 status);
    118            }
    119          #endif // EZSP_HOST && EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_BDB_JOIN_USES_INSTALL_CODE_KEY
    120          }
   \                     emberAfPluginNetworkCreatorSecurityInitCallback: (+1)
   \        0x0   0x4770             BX       LR               ;; return
    121          

   \                                 In section .text, align 2, keep-with-next
    122          void emberAfPluginNetworkCreatorSecurityStackStatusCallback(EmberStatus status)
    123          {
   \                     emberAfPluginNetworkCreatorSecurityStackStatusCallback: (+1)
   \        0x0   0x2890             CMP      R0,#+144
   \        0x2   0xD000             BEQ.N    ??emberAfPluginNetworkCreatorSecurityStackStatu_0
   \        0x4   0x4770             BX       LR
   \                     ??emberAfPluginNetworkCreatorSecurityStackStatu_0: (+1)
   \        0x6   0xB580             PUSH     {R7,LR}
    124          #ifdef EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT
    125            if (status == EMBER_NETWORK_UP
    126                && emberAfGetNodeId() == EMBER_TRUST_CENTER_NODE_ID) {
   \        0x8   0x....'....        BL       emberAfGetNodeId
   \        0xC   0xB968             CBNZ.N   R0,??emberAfPluginNetworkCreatorSecurityStackStatu_1
    127              EmberExtendedSecurityBitmask extended;
    128          
    129              // If we form a centralized network, make sure our trust center policy is
    130              // correctly set to respond to a key request.
    131          #ifdef ZCL_USING_SL_WWAH_CLUSTER_CLIENT
    132              allowTrustCenterLinkKeyRequestsAndGenerateNewKeys();
    133          #else
    134              allowTrustCenterLinkKeyRequests();
   \        0xE   0x2001             MOVS     R0,#+1
   \       0x10   0x....             LDR.N    R1,??DataTable8
   \       0x12   0x7008             STRB     R0,[R1, #+0]
    135          #endif
    136          
    137              // This bit is not saved to a token, so make sure that our security bitmask
    138              // has this bit set on reboot.
    139              emberGetExtendedSecurityBitmask(&extended);
   \       0x14   0x4668             MOV      R0,SP
   \       0x16   0x....'....        BL       emberGetExtendedSecurityBitmask
    140              extended |= EMBER_NWK_LEAVE_REQUEST_NOT_ALLOWED;
   \       0x1A   0xF8BD 0x0000      LDRH     R0,[SP, #+0]
   \       0x1E   0xF440 0x7080      ORR      R0,R0,#0x100
   \       0x22   0xF8AD 0x0000      STRH     R0,[SP, #+0]
    141              emberSetExtendedSecurityBitmask(extended);
   \       0x26   0x....'....        BL       emberSetExtendedSecurityBitmask
    142            }
    143          #endif /* EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT */
    144          }
   \                     ??emberAfPluginNetworkCreatorSecurityStackStatu_1: (+1)
   \       0x2A   0xBD01             POP      {R0,PC}          ;; return
    145          
    146          // -----------------------------------------------------------------------------
    147          // Stack Callbacks
    148          
    149          #if defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT) \
    150            || defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3)
    151          static bool isWildcardEui64(EmberEUI64 eui64)
    152          {
    153            for (uint8_t i = 0; i < EUI64_SIZE; i++) {
    154              if (eui64[i] != 0xFF) {
    155                return false;
    156              }
    157            }
    158            return true;
    159          }
    160          #endif /* defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT) \
    161                 || defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3) */
    162          
    163          #if defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3)
    164          extern uint8_t emAfPluginTestHarnessZ3ServerMaskHigh;
    165          #endif /* defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3) */
    166          

   \                                 In section .text, align 2, keep-with-next
    167          void emberAfPluginNetworkCreatorSecurityZigbeeKeyEstablishmentCallback(EmberEUI64 eui64,
    168                                                                                 EmberKeyStatus keyStatus)
    169          {
   \                     emberAfPluginNetworkCreatorSecurityZigbeeKeyEstablishmentCallback: (+1)
   \        0x0   0xB57C             PUSH     {R2-R6,LR}
   \        0x2   0x4604             MOV      R4,R0
    170          #if defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT) \
    171            || defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3)
    172            // If we are notified that a joining node failed to verify their
    173            // TCLK properly, then we are going to kick them off the network,
    174            // as they pose a potential security hazard.
    175          
    176          #if defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3)
    177            // Do nothing if we are pretending to be r20 or lower.
    178            if (emAfPluginTestHarnessZ3ServerMaskHigh == 0) {
    179              return;
    180            }
    181          #endif /* defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3) */
    182          
    183            if (!isWildcardEui64(eui64)
    184                && ((keyStatus == EMBER_TC_REQUESTER_VERIFY_KEY_TIMEOUT && !allowHaDevices)
    185                    || keyStatus == EMBER_TC_REQUESTER_VERIFY_KEY_FAILURE)) {
   \        0x4   0x2000             MOVS     R0,#+0
   \                     ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_0: (+1)
   \        0x6   0xB2C2             UXTB     R2,R0
   \        0x8   0x5CA2             LDRB     R2,[R4, R2]
   \        0xA   0x2AFF             CMP      R2,#+255
   \        0xC   0xD11E             BNE.N    ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_1
   \        0xE   0x1C40             ADDS     R0,R0,#+1
   \       0x10   0xB2C3             UXTB     R3,R0
   \       0x12   0x2B08             CMP      R3,#+8
   \       0x14   0xDBF7             BLT.N    ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_0
   \       0x16   0xBD73             POP      {R0,R1,R4-R6,PC}
   \                     ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_2: (+1)
   \       0x18   0x2933             CMP      R1,#+51
   \       0x1A   0xD116             BNE.N    ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_3
    186              EmberStatus status = EMBER_NOT_FOUND;
    187              EmberNodeId destinationId = lookupNodeIdByEui64(eui64);
   \                     ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_4: (+1)
   \       0x1C   0x4620             MOV      R0,R4
   \       0x1E   0x2503             MOVS     R5,#+3
   \       0x20   0x....'....        BL       emberLookupNodeIdByEui64
    188              if (destinationId != EMBER_NULL_NODE_ID) {
   \       0x24   0xF64F 0x71FF      MOVW     R1,#+65535
   \       0x28   0x4606             MOV      R6,R0
   \       0x2A   0x4288             CMP      R0,R1
   \       0x2C   0xD006             BEQ.N    ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_5
    189                // We do not tell the node to rejoin, since they may be malicious.
    190                status = emberLeaveRequest(destinationId,
    191                                           eui64,
    192                                           0, // no leave flags
    193                                           (EMBER_APS_OPTION_RETRY
    194                                            | EMBER_APS_OPTION_ENABLE_ROUTE_DISCOVERY));
   \       0x2E   0xF44F 0x73A0      MOV      R3,#+320
   \       0x32   0x2200             MOVS     R2,#+0
   \       0x34   0x4621             MOV      R1,R4
   \       0x36   0x....'....        BL       emberLeaveRequest
   \       0x3A   0x4605             MOV      R5,R0
    195              }
    196              emberAfCorePrintln("%p: Remove node 0x%2X for failed key verification: 0x%X",
    197                                 EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_PLUGIN_NAME,
    198                                 destinationId,
    199                                 status);
   \                     ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_5: (+1)
   \       0x3C   0x9500             STR      R5,[SP, #+0]
   \       0x3E   0x4633             MOV      R3,R6
   \       0x40   0x....             LDR.N    R2,??DataTable8_1
   \       0x42   0x....             LDR.N    R1,??DataTable8_2
   \       0x44   0x2001             MOVS     R0,#+1
   \       0x46   0x....'....        BL       emberAfPrintln
    200            }
    201          #endif /* defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT) \
    202                 || defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3) */
    203          }
   \                     ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_3: (+1)
   \       0x4A   0xBD73             POP      {R0,R1,R4-R6,PC}  ;; return
   \                     ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_1: (+1)
   \       0x4C   0x2932             CMP      R1,#+50
   \       0x4E   0xD1E3             BNE.N    ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_2
   \       0x50   0x....             LDR.N    R1,??DataTable8_3
   \       0x52   0x7808             LDRB     R0,[R1, #+0]
   \       0x54   0x2800             CMP      R0,#+0
   \       0x56   0xD1F8             BNE.N    ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_3
   \       0x58   0xE7E0             B.N      ??emberAfPluginNetworkCreatorSecurityZigbeeKeyE_4
    204          
    205          // -----------------------------------------------------------------------------
    206          // API
    207          

   \                                 In section .text, align 2, keep-with-next
    208          EmberStatus emberAfPluginNetworkCreatorSecurityStart(bool centralizedNetwork)
    209          {
   \                     emberAfPluginNetworkCreatorSecurityStart: (+1)
   \        0x0   0xB538             PUSH     {R3-R5,LR}
   \        0x2   0xB08C             SUB      SP,SP,#+48
   \        0x4   0x4604             MOV      R4,R0
    210            EmberInitialSecurityState state;
    211            EmberExtendedSecurityBitmask extended;
    212            EmberStatus status = EMBER_SUCCESS;
    213          
    214            MEMSET(&state, 0, sizeof(state));
   \        0x6   0x222C             MOVS     R2,#+44
   \        0x8   0x2100             MOVS     R1,#+0
   \        0xA   0xA801             ADD      R0,SP,#+4
   \        0xC   0x....'....        BL       halCommonMemSet
    215            state.bitmask = (EMBER_TRUST_CENTER_GLOBAL_LINK_KEY
    216                             | EMBER_HAVE_PRECONFIGURED_KEY
    217                             | EMBER_HAVE_NETWORK_KEY
    218                             | EMBER_NO_FRAME_COUNTER_RESET
    219                             | EMBER_REQUIRE_ENCRYPTED_KEY);
   \       0x10   0xF641 0x3104      MOVW     R1,#+6916
   \       0x14   0xF8AD 0x1004      STRH     R1,[SP, #+4]
    220          
    221            extended = EMBER_JOINER_GLOBAL_LINK_KEY;
   \       0x18   0x2510             MOVS     R5,#+16
    222          
    223            if (!centralizedNetwork) {
   \       0x1A   0xB954             CBNZ.N   R4,??emberAfPluginNetworkCreatorSecurityStart_0
    224              MEMMOVE(&(state.preconfiguredKey),
    225                      emberKeyContents(&distributedKey),
    226                      EMBER_ENCRYPTION_KEY_SIZE);
   \       0x1C   0x2210             MOVS     R2,#+16
   \       0x1E   0x....             LDR.N    R1,??DataTable8_4
   \       0x20   0xF10D 0x0006      ADD      R0,SP,#+6
   \       0x24   0x....'....        BL       halCommonMemMove
    227          
    228              // Use distributed trust center mode.
    229              state.bitmask |= EMBER_DISTRIBUTED_TRUST_CENTER_MODE;
   \       0x28   0xF8BD 0x0004      LDRH     R0,[SP, #+4]
   \       0x2C   0xF040 0x0002      ORR      R0,R0,#0x2
   \       0x30   0xE00B             B.N      ??emberAfPluginNetworkCreatorSecurityStart_1
    230            }
    231          #if defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT) \
    232            || defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3)
    233            else { // centralizedNetwork
    234              // Generate a random global link key.
    235              // This is the key the trust center will send to a joining node when it
    236              // updates its link key.
    237              status = emberAfGenerateRandomKey(&(state.preconfiguredKey));
   \                     ??emberAfPluginNetworkCreatorSecurityStart_0: (+1)
   \       0x32   0xF10D 0x0006      ADD      R0,SP,#+6
   \       0x36   0x....'....        BL       emberGenerateRandomKey
   \       0x3A   0x0004             MOVS     R4,R0
    238              if (status != EMBER_SUCCESS) {
   \       0x3C   0xD116             BNE.N    ??emberAfPluginNetworkCreatorSecurityStart_2
    239                goto kickout;
    240              }
    241          
    242              // Use hashed link keys for improved storage and speed.
    243              state.bitmask |= EMBER_TRUST_CENTER_USES_HASHED_LINK_KEY;
   \       0x3E   0xF8BD 0x0004      LDRH     R0,[SP, #+4]
    244          
    245              // Tell the trust center to ignore leave requests.
    246              extended |= EMBER_NWK_LEAVE_REQUEST_NOT_ALLOWED;
   \       0x42   0xF44F 0x7588      MOV      R5,#+272
   \       0x46   0xF040 0x0084      ORR      R0,R0,#0x84
   \                     ??emberAfPluginNetworkCreatorSecurityStart_1: (+1)
   \       0x4A   0xF8AD 0x0004      STRH     R0,[SP, #+4]
    247            }
    248          #endif /* defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT) \
    249                 || defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3) */
    250          
    251            // Generate a random network key.
    252            status = emberAfGenerateRandomKey(&(state.networkKey));
   \       0x4E   0xF10D 0x0016      ADD      R0,SP,#+22
   \       0x52   0x....'....        BL       emberGenerateRandomKey
   \       0x56   0x0004             MOVS     R4,R0
    253            if (status != EMBER_SUCCESS) {
   \       0x58   0xD108             BNE.N    ??emberAfPluginNetworkCreatorSecurityStart_2
    254              goto kickout;
    255            }
    256          
    257            // Set the initial security data.
    258            status = setInitialSecurityState(&state);
   \       0x5A   0xA801             ADD      R0,SP,#+4
   \       0x5C   0x....'....        BL       emberSetInitialSecurityState
   \       0x60   0x0004             MOVS     R4,R0
    259            if (status != EMBER_SUCCESS) {
   \       0x62   0xD103             BNE.N    ??emberAfPluginNetworkCreatorSecurityStart_2
    260              goto kickout;
    261            }
    262            status = emberSetExtendedSecurityBitmask(extended);
   \       0x64   0x4628             MOV      R0,R5
   \       0x66   0x....'....        BL       emberSetExtendedSecurityBitmask
   \       0x6A   0x4604             MOV      R4,R0
    263          
    264            kickout:
    265            emberAfCorePrintln("%p: %p: 0x%X",
    266                               EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_PLUGIN_NAME,
    267                               "Start",
    268                               status);
   \                     ??emberAfPluginNetworkCreatorSecurityStart_2: (+1)
   \       0x6C   0x9400             STR      R4,[SP, #+0]
   \       0x6E   0x....             LDR.N    R3,??DataTable8_5
   \       0x70   0x....'....        BL       ?Subroutine1
    269            return status;
   \                     ??CrossCallReturnLabel_3: (+1)
   \       0x74   0x4620             MOV      R0,R4
   \       0x76   0xB00D             ADD      SP,SP,#+52
   \       0x78   0xBD30             POP      {R4,R5,PC}       ;; return
    270          }

   \                                 In section .text, align 2, keep-with-next
   \                     ?Subroutine1: (+1)
   \        0x0   0x....             LDR.N    R2,??DataTable8_1
   \        0x2   0x....             LDR.N    R1,??DataTable8_12
   \        0x4   0x2001             MOVS     R0,#+1
   \        0x6   0x....'....        B.W      emberAfPrintln
    271          

   \                                 In section .text, align 2, keep-with-next
    272          EmberStatus emberAfPluginNetworkCreatorSecurityOpenNetwork(void)
    273          {
   \                     emberAfPluginNetworkCreatorSecurityOpenNetwork: (+1)
   \        0x0   0xB510             PUSH     {R4,LR}
   \        0x2   0xB086             SUB      SP,SP,#+24
    274            EmberStatus status = EMBER_SUCCESS;
   \        0x4   0x2400             MOVS     R4,#+0
    275          
    276            if (emberAfNetworkState() != EMBER_JOINED_NETWORK) {
   \        0x6   0x....'....        BL       emberAfNetworkState
   \        0xA   0x2802             CMP      R0,#+2
   \        0xC   0xBF18             IT       NE 
   \        0xE   0x2001             MOVNE    R0,#+1
    277              return EMBER_ERR_FATAL;
   \       0x10   0xD115             BNE.N    ??emberAfPluginNetworkCreatorSecurityOpenNetwor_0
    278            }
    279          #if defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_ALLOW_TC_REJOIN_WITH_WELL_KNOWN_KEY)
    280            #if defined(EMBER_TEST)
    281              #define EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_ALLOW_TC_REJOINS_USING_WELL_KNOWN_KEY_TIMEOUT_SEC 0
    282            #endif
    283            setTcRejoinsUsingWellKnownKeyTimeout(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_ALLOW_TC_REJOINS_USING_WELL_KNOWN_KEY_TIMEOUT_SEC);
    284            setTcRejoinsUsingWellKnownKeyAllowed(true);
    285          #endif
    286          
    287          #if defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT) \
    288            || defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3)
    289            if (emberAfGetNodeId() == EMBER_TRUST_CENTER_NODE_ID) {
   \       0x12   0x....'....        BL       emberAfGetNodeId
   \       0x16   0xB978             CBNZ.N   R0,??emberAfPluginNetworkCreatorSecurityOpenNetwor_1
    290              EmberEUI64 wildcardEui64 = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, };
   \       0x18   0x....             LDR.N    R1,??DataTable8_6
   \       0x1A   0xE9D1 0x2300      LDRD     R2,R3,[R1, #+0]
    291              EmberKeyData centralizedKey = ZIGBEE_3_CENTRALIZED_SECURITY_LINK_KEY;
   \       0x1E   0xA802             ADD      R0,SP,#+8
   \       0x20   0x....             LDR.N    R1,??DataTable8_7
   \       0x22   0xE9CD 0x2300      STRD     R2,R3,[SP, #+0]
   \       0x26   0x2210             MOVS     R2,#+16
   \       0x28   0x....'....        BL       __aeabi_memcpy4
    292              status = addTransientLinkKey(wildcardEui64, &centralizedKey);
   \       0x2C   0xA902             ADD      R1,SP,#+8
   \       0x2E   0x4668             MOV      R0,SP
   \       0x30   0x....'....        BL       emberAddTransientLinkKey
   \       0x34   0x0004             MOVS     R4,R0
    293            }
    294          #endif /* defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT) \
    295                 || defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3) */
    296          
    297            if (status == EMBER_SUCCESS) {
   \       0x36   0xD101             BNE.N    ??CrossCallReturnLabel_1
    298              openNetworkTimeRemainingS = NETWORK_OPEN_TIME_S;
   \                     ??emberAfPluginNetworkCreatorSecurityOpenNetwor_1: (+1)
   \       0x38   0x....'....        BL       ?Subroutine0
    299              setTransientKeyTimeout(openNetworkTimeRemainingS);
    300              emberEventControlSetActive(openNetworkEventControl);
    301            }
    302          
    303            return status;
   \                     ??CrossCallReturnLabel_1: (+1)
   \       0x3C   0x4620             MOV      R0,R4
   \                     ??emberAfPluginNetworkCreatorSecurityOpenNetwor_0: (+1)
   \       0x3E   0xB006             ADD      SP,SP,#+24
   \       0x40   0xBD10             POP      {R4,PC}          ;; return
    304          }

   \                                 In section .text, align 2, keep-with-next
   \                     ?Subroutine0: (+1)
   \        0x0   0xF44F 0x7096      MOV      R0,#+300
   \        0x4   0x....             LDR.N    R1,??DataTable8_9
   \        0x6   0x8008             STRH     R0,[R1, #+0]
   \        0x8   0x....             LDR.N    R2,??DataTable8_10
   \        0xA   0x8010             STRH     R0,[R2, #+0]
   \        0xC   0x....             LDR.N    R0,??DataTable8_8
   \        0xE   0x....'....        B.W      emEventControlSetActive
    305          

   \                                 In section .text, align 2, keep-with-next
    306          EmberStatus emberAfPluginNetworkCreatorSecurityCloseNetwork(void)
    307          {
   \                     emberAfPluginNetworkCreatorSecurityCloseNetwork: (+1)
   \        0x0   0xB510             PUSH     {R4,LR}
    308            EmberStatus status = EMBER_ERR_FATAL;
   \        0x2   0x2401             MOVS     R4,#+1
    309          
    310            if (emberAfNetworkState() == EMBER_JOINED_NETWORK) {
   \        0x4   0x....'....        BL       emberAfNetworkState
   \        0x8   0x2802             CMP      R0,#+2
   \        0xA   0xD10C             BNE.N    ??emberAfPluginNetworkCreatorSecurityCloseNetwo_0
    311              clearTransientLinkKeys();
   \        0xC   0x....'....        BL       emberClearTransientLinkKeys
    312              emberEventControlSetInactive(openNetworkEventControl);
   \       0x10   0x2000             MOVS     R0,#+0
   \       0x12   0x....             LDR.N    R1,??DataTable8_8
   \       0x14   0x7008             STRB     R0,[R1, #+0]
    313              zaTrustCenterSetJoinPolicy(EMBER_NO_ACTION);
   \       0x16   0x2003             MOVS     R0,#+3
   \       0x18   0x....'....        BL       zaTrustCenterSetJoinPolicy
    314              status = emberAfPermitJoin(0, true); // broadcast
   \       0x1C   0x2101             MOVS     R1,#+1
   \       0x1E   0x2000             MOVS     R0,#+0
   \       0x20   0x....'....        BL       emberAfPermitJoin
   \       0x24   0x4604             MOV      R4,R0
    315            }
    316          
    317            return status;
   \                     ??emberAfPluginNetworkCreatorSecurityCloseNetwo_0: (+1)
   \       0x26   0x4620             MOV      R0,R4
   \       0x28   0xBD10             POP      {R4,PC}          ;; return
    318          }
    319          

   \                                 In section .text, align 2, keep-with-next
    320          EmberStatus emberAfPluginNetworkCreatorSecurityOpenNetworkWithKeyPair(EmberEUI64 eui64,
    321                                                                                EmberKeyData keyData)
    322          {
   \                     emberAfPluginNetworkCreatorSecurityOpenNetworkWithKeyPair: (+1)
   \        0x0   0xB40E             PUSH     {R1-R3}
   \        0x2   0xB530             PUSH     {R4,R5,LR}
   \        0x4   0x4604             MOV      R4,R0
    323            EmberStatus status = EMBER_SUCCESS;
   \        0x6   0x2500             MOVS     R5,#+0
    324          
    325            if (emberAfNetworkState() != EMBER_JOINED_NETWORK) {
   \        0x8   0x....'....        BL       emberAfNetworkState
   \        0xC   0x2802             CMP      R0,#+2
   \        0xE   0xBF18             IT       NE 
   \       0x10   0x2001             MOVNE    R0,#+1
    326              return EMBER_ERR_FATAL;
   \       0x12   0xD10B             BNE.N    ??emberAfPluginNetworkCreatorSecurityOpenNetwor_2
    327            }
    328          
    329          #if defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT) \
    330            || defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3)
    331            if (emberAfGetNodeId() == EMBER_TRUST_CENTER_NODE_ID) {
   \       0x14   0x....'....        BL       emberAfGetNodeId
   \       0x18   0xB928             CBNZ.N   R0,??emberAfPluginNetworkCreatorSecurityOpenNetwor_3
    332              status = addTransientLinkKey(eui64, &keyData);
   \       0x1A   0xA903             ADD      R1,SP,#+12
   \       0x1C   0x4620             MOV      R0,R4
   \       0x1E   0x....'....        BL       emberAddTransientLinkKey
   \       0x22   0x0005             MOVS     R5,R0
    333            }
    334          #endif /* defined(EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_TRUST_CENTER_SUPPORT) \
    335                 || defined(EMBER_AF_PLUGIN_TEST_HARNESS_Z3) */
    336          
    337            if (status == EMBER_SUCCESS) {
   \       0x24   0xD101             BNE.N    ??CrossCallReturnLabel_0
    338              openNetworkTimeRemainingS = NETWORK_OPEN_TIME_S;
   \                     ??emberAfPluginNetworkCreatorSecurityOpenNetwor_3: (+1)
   \       0x26   0x....'....        BL       ?Subroutine0
    339              setTransientKeyTimeout(openNetworkTimeRemainingS);
    340              emberEventControlSetActive(openNetworkEventControl);
    341            }
    342          
    343            return status;
   \                     ??CrossCallReturnLabel_0: (+1)
   \       0x2A   0x4628             MOV      R0,R5
   \                     ??emberAfPluginNetworkCreatorSecurityOpenNetwor_2: (+1)
   \       0x2C   0xBC30             POP      {R4,R5}
   \       0x2E   0xF85D 0xFB10      LDR      PC,[SP], #+16    ;; return
    344          }
    345          
    346          // -----------------------------------------------------------------------------
    347          // Internal Definitions
    348          

   \                                 In section .text, align 2, keep-with-next
    349          void emberAfPluginNetworkCreatorSecurityOpenNetworkEventHandler(void)
    350          {
   \                     emberAfPluginNetworkCreatorSecurityOpenNetworkEventHandler: (+1)
   \        0x0   0xB538             PUSH     {R3-R5,LR}
    351            EmberStatus status = EMBER_SUCCESS;
    352            uint8_t permitJoinTime;
    353          
    354            emberEventControlSetInactive(openNetworkEventControl);
   \        0x2   0x....             LDR.N    R4,??DataTable8_8
   \        0x4   0x2000             MOVS     R0,#+0
   \        0x6   0x7020             STRB     R0,[R4, #+0]
    355          
    356            // If we have left the network, then we don't need to proceed further.
    357            if (emberAfNetworkState() != EMBER_JOINED_NETWORK) {
   \        0x8   0x....'....        BL       emberAfNetworkState
   \        0xC   0x2802             CMP      R0,#+2
   \        0xE   0xD11A             BNE.N    ??CrossCallReturnLabel_2
    358              return;
    359            }
    360          
    361            if (openNetworkTimeRemainingS > EMBER_AF_PERMIT_JOIN_MAX_TIMEOUT) {
   \       0x10   0x....             LDR.N    R0,??DataTable8_9
   \       0x12   0x8801             LDRH     R1,[R0, #+0]
   \       0x14   0x29FF             CMP      R1,#+255
   \       0x16   0xDB08             BLT.N    ??emberAfPluginNetworkCreatorSecurityOpenNetwor_4
    362              permitJoinTime = EMBER_AF_PERMIT_JOIN_MAX_TIMEOUT;
    363              openNetworkTimeRemainingS -= EMBER_AF_PERMIT_JOIN_MAX_TIMEOUT;
   \       0x18   0x39FE             SUBS     R1,R1,#+254
   \       0x1A   0x8001             STRH     R1,[R0, #+0]
    364              emberEventControlSetDelayQS(openNetworkEventControl,
    365                                          EMBER_AF_PERMIT_JOIN_MAX_TIMEOUT << 2);
   \       0x1C   0xF44F 0x317E      MOV      R1,#+260096
   \       0x20   0x4620             MOV      R0,R4
   \       0x22   0x25FE             MOVS     R5,#+254
   \       0x24   0x....'....        BL       emEventControlSetDelayMS
   \       0x28   0xE002             B.N      ??emberAfPluginNetworkCreatorSecurityOpenNetwor_5
    366            } else {
    367              permitJoinTime = openNetworkTimeRemainingS;
   \                     ??emberAfPluginNetworkCreatorSecurityOpenNetwor_4: (+1)
   \       0x2A   0x460D             MOV      R5,R1
    368              openNetworkTimeRemainingS = 0;
   \       0x2C   0x2100             MOVS     R1,#+0
   \       0x2E   0x8001             STRH     R1,[R0, #+0]
    369            }
    370          
    371            if (status == EMBER_SUCCESS) {
    372              zaTrustCenterSetJoinPolicy(EMBER_USE_PRECONFIGURED_KEY);
   \                     ??emberAfPluginNetworkCreatorSecurityOpenNetwor_5: (+1)
   \       0x30   0x2000             MOVS     R0,#+0
   \       0x32   0x....'....        BL       zaTrustCenterSetJoinPolicy
    373              status = emberAfPermitJoin(permitJoinTime, true); // broadcast permit join
   \       0x36   0x2101             MOVS     R1,#+1
   \       0x38   0xB2E8             UXTB     R0,R5
   \       0x3A   0x....'....        BL       emberAfPermitJoin
    374            }
    375          
    376            emberAfCorePrintln("%p: %p: 0x%X",
    377                               EMBER_AF_PLUGIN_NETWORK_CREATOR_SECURITY_PLUGIN_NAME,
    378                               "Open network",
    379                               status);
   \       0x3E   0x9000             STR      R0,[SP, #+0]
   \       0x40   0x....             LDR.N    R3,??DataTable8_11
   \       0x42   0x....'....        BL       ?Subroutine1
    380          }
   \                     ??CrossCallReturnLabel_2: (+1)
   \       0x46   0xBD31             POP      {R0,R4,R5,PC}    ;; return

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8:
   \        0x0   0x....'....        DC32     emberTrustCenterLinkKeyRequestPolicy

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_1:
   \        0x0   0x....'....        DC32     ?_1

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_2:
   \        0x0   0x....'....        DC32     ?_0

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_3:
   \        0x0   0x....'....        DC32     allowHaDevices

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_4:
   \        0x0   0x....'....        DC32     distributedKey

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_5:
   \        0x0   0x....'....        DC32     ?_3

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_6:
   \        0x0   0x....'....        DC32     ?_4

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_7:
   \        0x0   0x....'....        DC32     ?_5

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_8:
   \        0x0   0x....'....        DC32     emberAfPluginNetworkCreatorSecurityOpenNetworkEventControl

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_9:
   \        0x0   0x....'....        DC32     openNetworkTimeRemainingS

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_10:
   \        0x0   0x....'....        DC32     emberTransientKeyTimeoutS

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_11:
   \        0x0   0x....'....        DC32     ?_6

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_12:
   \        0x0   0x....'....        DC32     ?_2

   \                                 In section .rodata, align 4
   \                     ?_0:
   \        0x0   0x25 0x70          DC8 25H, 70H, 3AH, 20H, 52H, 65H, 6DH, 6FH
   \              0x3A 0x20    
   \              0x52 0x65    
   \              0x6D 0x6F    
   \        0x8   0x76 0x65          DC8 76H, 65H, 20H, 6EH, 6FH, 64H, 65H, 20H
   \              0x20 0x6E    
   \              0x6F 0x64    
   \              0x65 0x20    
   \       0x10   0x30 0x78          DC8 30H, 78H, 25H, 32H, 58H, 20H, 66H, 6FH
   \              0x25 0x32    
   \              0x58 0x20    
   \              0x66 0x6F    
   \       0x18   0x72 0x20          DC8 72H, 20H, 66H, 61H, 69H, 6CH, 65H, 64H
   \              0x66 0x61    
   \              0x69 0x6C    
   \              0x65 0x64    
   \       0x20   0x20 0x6B          DC8 20H, 6BH, 65H, 79H, 20H, 76H, 65H, 72H
   \              0x65 0x79    
   \              0x20 0x76    
   \              0x65 0x72    
   \       0x28   0x69 0x66          DC8 69H, 66H, 69H, 63H, 61H, 74H, 69H, 6FH
   \              0x69 0x63    
   \              0x61 0x74    
   \              0x69 0x6F    
   \       0x30   0x6E 0x3A          DC8 6EH, 3AH, 20H, 30H, 78H, 25H, 58H, 0
   \              0x20 0x30    
   \              0x78 0x25    
   \              0x58 0x00    

   \                                 In section .rodata, align 4
   \                     ?_1:
   \        0x0   0x4E 0x57          DC8 "NWK Creator Security"
   \              0x4B 0x20    
   \              0x43 0x72    
   \              0x65 0x61    
   \              0x74 0x6F    
   \              0x72 0x20    
   \              0x53 0x65    
   \              0x63 0x75    
   \              0x72 0x69    
   \              0x74 0x79    
   \              0x00         
   \       0x15   0x00 0x00          DC8 0, 0, 0
   \              0x00         

   \                                 In section .rodata, align 4
   \                     ?_2:
   \        0x0   0x25 0x70          DC8 "%p: %p: 0x%X"
   \              0x3A 0x20    
   \              0x25 0x70    
   \              0x3A 0x20    
   \              0x30 0x78    
   \              0x25 0x58    
   \              0x00         
   \        0xD   0x00 0x00          DC8 0, 0, 0
   \              0x00         

   \                                 In section .rodata, align 4
   \                     ?_3:
   \        0x0   0x53 0x74          DC8 "Start"
   \              0x61 0x72    
   \              0x74 0x00    
   \        0x6   0x00 0x00          DC8 0, 0

   \                                 In section .rodata, align 4
   \                     ?_4:
   \        0x0   0xFF 0xFF          DC8 255, 255, 255, 255, 255, 255, 255, 255
   \              0xFF 0xFF    
   \              0xFF 0xFF    
   \              0xFF 0xFF    

   \                                 In section .rodata, align 4
   \                     ?_5:
   \        0x0   0x5A 0x69          DC8 90, 105, 103, 66, 101, 101, 65, 108, 108, 105, 97, 110, 99, 101, 48
   \              0x67 0x42    
   \              0x65 0x65    
   \              0x41 0x6C    
   \              0x6C 0x69    
   \              0x61 0x6E    
   \              0x63 0x65    
   \              0x30         
   \        0xF   0x39               DC8 57

   \                                 In section .rodata, align 4
   \                     ?_6:
   \        0x0   0x4F 0x70          DC8 "Open network"
   \              0x65 0x6E    
   \              0x20 0x6E    
   \              0x65 0x74    
   \              0x77 0x6F    
   \              0x72 0x6B    
   \              0x00         
   \        0xD   0x00 0x00          DC8 0, 0, 0
   \              0x00         

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       8   emberAfPluginNetworkCreatorSecurityCloseNetwork
         8   -> emberAfNetworkState
         8   -> emberAfPermitJoin
         8   -> emberClearTransientLinkKeys
         8   -> zaTrustCenterSetJoinPolicy
       0   emberAfPluginNetworkCreatorSecurityInitCallback
      32   emberAfPluginNetworkCreatorSecurityOpenNetwork
        32   -> __aeabi_memcpy4
        32   -> emEventControlSetActive
        32   -> emberAddTransientLinkKey
        32   -> emberAfGetNodeId
        32   -> emberAfNetworkState
      16   emberAfPluginNetworkCreatorSecurityOpenNetworkEventHandler
        16   -> emEventControlSetDelayMS
        16   -> emberAfNetworkState
        16   -> emberAfPermitJoin
        16   -> emberAfPrintln
        16   -> zaTrustCenterSetJoinPolicy
      24   emberAfPluginNetworkCreatorSecurityOpenNetworkWithKeyPair
        24   -> emEventControlSetActive
        24   -> emberAddTransientLinkKey
        24   -> emberAfGetNodeId
        24   -> emberAfNetworkState
       8   emberAfPluginNetworkCreatorSecurityStackStatusCallback
         8   -> emberAfGetNodeId
         8   -> emberGetExtendedSecurityBitmask
         8   -> emberSetExtendedSecurityBitmask
      64   emberAfPluginNetworkCreatorSecurityStart
        64   -> emberAfPrintln
        64   -> emberGenerateRandomKey
        64   -> emberSetExtendedSecurityBitmask
        64   -> emberSetInitialSecurityState
        64   -> halCommonMemMove
        64   -> halCommonMemSet
      24   emberAfPluginNetworkCreatorSecurityZigbeeKeyEstablishmentCallback
        24   -> emberAfPrintln
        24   -> emberLeaveRequest
        24   -> emberLookupNodeIdByEui64


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable8
       4  ??DataTable8_1
       4  ??DataTable8_10
       4  ??DataTable8_11
       4  ??DataTable8_12
       4  ??DataTable8_2
       4  ??DataTable8_3
       4  ??DataTable8_4
       4  ??DataTable8_5
       4  ??DataTable8_6
       4  ??DataTable8_7
       4  ??DataTable8_8
       4  ??DataTable8_9
      18  ?Subroutine0
      10  ?Subroutine1
      56  ?_0
      24  ?_1
      16  ?_2
       8  ?_3
       8  ?_4
      16  ?_5
      16  ?_6
       1  allowHaDevices
      16  distributedKey
      42  emberAfPluginNetworkCreatorSecurityCloseNetwork
       2  emberAfPluginNetworkCreatorSecurityInitCallback
      66  emberAfPluginNetworkCreatorSecurityOpenNetwork
       8  emberAfPluginNetworkCreatorSecurityOpenNetworkEventControl
      72  emberAfPluginNetworkCreatorSecurityOpenNetworkEventHandler
      50  emberAfPluginNetworkCreatorSecurityOpenNetworkWithKeyPair
      44  emberAfPluginNetworkCreatorSecurityStackStatusCallback
     122  emberAfPluginNetworkCreatorSecurityStart
      90  emberAfPluginNetworkCreatorSecurityZigbeeKeyEstablishmentCallback
       2  openNetworkTimeRemainingS

 
  10 bytes in section .bss
  17 bytes in section .data
 144 bytes in section .rodata
 568 bytes in section .text
 
 568 bytes of CODE  memory
 144 bytes of CONST memory
  27 bytes of DATA  memory

Errors: none
Warnings: none
