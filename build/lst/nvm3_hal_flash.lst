###############################################################################
#
# IAR ANSI C/C++ Compiler V8.32.2.178/W32 for ARM         14/Jun/2019  13:19:28
# Copyright 1999-2018 IAR Systems AB.
#
#    Cpu mode     =  
#    Endian       =  little
#    Source file  =  
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.6\platform\emdrv\nvm3\src\nvm3_hal_flash.c
#    Command line =  
#        -f C:\Users\alji\AppData\Local\Temp\EWE5BA.tmp
#        (C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.6\platform\emdrv\nvm3\src\nvm3_hal_flash.c
#        -D LOCAL_STORAGE_BTL -D CORTEXM3 -D CORTEXM3_EFR32 -D
#        CORTEXM3_EFR32_MICRO -D CORTEXM3_EFM32_MICRO -D
#        EFR32_SERIES2_CONFIG1_MICRO -D EFR32MG21 -D EFR32MG21A010F1024IM32 -D
#        "ATTRIBUTE_STORAGE_CONFIGURATION=\"z3_lite_timer_mg21_v660_endpoint_config.h\""
#        -D "CONFIGURATION_HEADER=\"app/framework/util/config.h\"" -D
#        "GENERATED_TOKEN_HEADER=\"z3_lite_timer_mg21_v660_tokens.h\"" -D
#        "PLATFORM_HEADER=\"platform/base/hal/micro/cortexm3/compiler/iar.h\""
#        -D "ZA_GENERATED_HEADER=\"z3_lite_timer_mg21_v660.h\"" -D
#        "__SOURCEFILE__=\"nvm3_hal_flash.c\"" -D PSSTORE_SIZE=0 -D
#        LONGTOKEN_SIZE=0 -D LOCKBITS_IN_MAINFLASH_SIZE=8192 -D HAL_CONFIG=1 -D
#        EMBER_AF_USE_HWCONF -D LED_BLINK_PERIOD_MS=1000 -D NO_LED=1 -D
#        "EMBER_AF_API_EMBER_TYPES=\"stack/include/ember-types.h\"" -D
#        "EMBER_AF_API_DEBUG_PRINT=\"app/framework/util/print.h\"" -D
#        "EMBER_AF_API_AF_HEADER=\"app/framework/include/af.h\"" -D
#        "EMBER_AF_API_AF_SECURITY_HEADER=\"app/framework/security/af-security.h\""
#        -D EMBER_STACK_ZIGBEE -D
#        "MBEDTLS_CONFIG_FILE=\"mbedtls-config-generated.h\"" -D USE_NVM3 -D
#        NVM3_DEFAULT_NVM_SIZE=NVM3_FLASH_PAGES*FLASH_PAGE_SIZE -D
#        EMLIB_USER_CONFIG -D HAL_BULBPWM_ENABLE=1 -D
#        HAL_BULBPWM_FREQUENCY=1000 -D
#        "APPLICATION_TOKEN_HEADER=\"znet-token.h\"" -D
#        "APPLICATION_MFG_TOKEN_HEADER=\"znet-mfg-token.h\"" -D
#        "MBEDTLS_DEVICE_ACCELERATION_CONFIG_FILE=\"configs/config-device-acceleration.h\""
#        -D
#        "MBEDTLS_DEVICE_ACCELERATION_CONFIG_APP_FILE=\"config-device-acceleration-app.h\""
#        -D NVM3_FLASH_PAGES=4 -D NVM3_DEFAULT_CACHE_SIZE=200 -D
#        NVM3_MAX_OBJECT_SIZE=254 -D NVM3_DEFAULT_REPACK_HEADROOM=0 -D
#        PHY_RAIL=1 -lC
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\build\lst
#        --diag_suppress Pa050 -o
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\build\obj
#        --no_unroll --no_clustering --debug --endian=little
#        --cpu=Cortex-M33.no_dsp --cmse --no_path_in_file_macros
#        --separate_cluster_for_initialized_variables -e --fpu=None
#        --dlib_config "C:\Program Files (x86)\IAR Systems\Embedded Workbench
#        8.2\arm\inc\c\DLib_Config_Normal.h" -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.6\platform\emdrv\nvm3\src\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\protocol\zigbee\app\framework\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\protocol\zigbee\app\framework\..\..\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\protocol\zigbee\app\framework\..\..\stack\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\protocol\zigbee\app\framework\..\util\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\protocol\zigbee\app\framework\include\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\plugin\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\micro\cortexm3\efm32\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\micro\cortexm3\efm32\config\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\micro\cortexm3\efm32\efr32\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\CMSIS\Include\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\Device\SiliconLabs\efr32mg21\Include\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\common\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\config\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\dmadrv\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\gpiointerrupt\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\rtcdrv\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\sleep\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\spidrv\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\tempdrv\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\uartdrv\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emdrv\ustimer\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\emlib\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\middleware\glib\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\middleware\glib\glib\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\radio\rail_lib\plugin\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\radio\rail_lib\chip\efr32\rf\common\cortex\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\base\hal\..\..\radio\rail_lib\chip\efr32\rf\rfprotocol\ieee802154\cortex\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\halconfig\inc\hal-config\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\hardware\module\config\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\hardware\kit\common\halconfig\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\hardware\kit\common\bsp\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\hal-config\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\bootloader\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\emdrv\nvm3\inc\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\chip\efr32\efr32xg2x\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\common\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\plugin\coexistence\common\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\plugin\coexistence\hal\efr32\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\plugin\coexistence\protocol\ieee802154\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\protocol\ble\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\protocol\ieee802154\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\platform\radio\rail_lib\protocol\zwave\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\util\plugin\plugin-common\mbedtls\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\util\third_party\mbedtls\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\util\third_party\mbedtls\include\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\util\third_party\mbedtls\include\mbedtls\
#        -I
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\..\..\v2.6\util\third_party\mbedtls\sl_crypto\include\
#        -Ohz --use_c++_inline)
#    Locale       =  C
#    List file    =  
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\build\lst\nvm3_hal_flash.lst
#    Object file  =  
#        C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.5\z3_lite_timer_mg21_v660\build\obj\nvm3_hal_flash.o
#
###############################################################################

C:\SiliconLabs\SimplicityStudio\v4\developer\sdks\gecko_sdk_suite\v2.6\platform\emdrv\nvm3\src\nvm3_hal_flash.c
      1          /***************************************************************************//**
      2           * @file
      3           * @brief Non-Volatile Memory Wear-Leveling driver HAL implementation
      4           *******************************************************************************
      5           * # License
      6           * <b>Copyright 2018 Silicon Laboratories Inc. www.silabs.com</b>
      7           *******************************************************************************
      8           *
      9           * The licensor of this software is Silicon Laboratories Inc.  Your use of this
     10           * software is governed by the terms of Silicon Labs Master Software License
     11           * Agreement (MSLA) available at
     12           * www.silabs.com/about-us/legal/master-software-license-agreement.  This
     13           * software is distributed to you in Source Code format and is governed by the
     14           * sections of the MSLA applicable to Source Code.
     15           *
     16           ******************************************************************************/
     17          
     18          #include <stdbool.h>
     19          #include <string.h>
     20          #include "nvm3.h"
     21          #include "nvm3_hal_flash.h"
     22          #include "em_system.h"
     23          #include "em_msc.h"
     24          
     25          /***************************************************************************//**
     26           * @addtogroup emdrv
     27           * @{
     28           ******************************************************************************/
     29          
     30          /***************************************************************************//**
     31           * @addtogroup NVM3
     32           * @{
     33           ******************************************************************************/
     34          
     35          /***************************************************************************//**
     36           * @addtogroup NVM3Hal
     37           * @{
     38           ******************************************************************************/
     39          
     40          /******************************************************************************
     41           ******************************    MACROS    **********************************
     42           *****************************************************************************/
     43          
     44          #define CHECK_DATA  1           ///< Macro defining if data should be checked
     45          
     46          /******************************************************************************
     47           ***************************   LOCAL VARIABLES   ******************************
     48           *****************************************************************************/
     49          
     50          /******************************************************************************
     51           ***************************   LOCAL FUNCTIONS   ******************************
     52           *****************************************************************************/
     53          
     54          /** @cond DO_NOT_INCLUDE_WITH_DOXYGEN */
     55          
     56          /***************************************************************************//**
     57           * @brief
     58           *   Convert return type.
     59           *
     60           * @details
     61           *   This function converts between the return type of the emlib and the
     62           *   NVM3 API.
     63           *
     64           * @param[in] result
     65           *   Operation result.
     66           *
     67           * @return
     68           *   Returns remapped status code.
     69           ******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
     70          static Ecode_t convertMscStatusToNvm3Status(MSC_Status_TypeDef result)
     71          {
     72            Ecode_t ret;
     73          
     74            switch (result) {
   \                     convertMscStatusToNvm3Status: (+1)
   \        0x0   0xB128             CBZ.N    R0,??convertMscStatusToNvm3Status_0
   \        0x2   0xF1B0 0x3FFF      CMP      R0,#-1
   \        0x6   0xD101             BNE.N    ??convertMscStatusToNvm3Status_1
     75              case mscReturnOk:
     76                ret = ECODE_NVM3_OK;
     77                break;
     78              case mscReturnInvalidAddr:
     79                ret = ECODE_NVM3_ERR_INT_ADDR_INVALID;
   \        0x8   0x....             LDR.N    R0,??DataTable3  ;; 0xf000e021
     80                break;
   \        0xA   0x4770             BX       LR
     81              default:
     82                ret = ECODE_NVM3_ERR_INT_EMULATOR;
   \                     ??convertMscStatusToNvm3Status_1: (+1)
   \        0xC   0x....             LDR.N    R0,??DataTable3_1  ;; 0xf000e024
     83                break;
     84            }
     85          
     86            return ret;
   \                     ??convertMscStatusToNvm3Status_0: (+1)
   \        0xE   0x4770             BX       LR               ;; return
     87          }
     88          
     89          // Check if the page is erased.
     90          static bool isErased(void *adr, size_t len)
     91          {
     92            size_t i;
     93            size_t cnt;
     94            uint32_t *dat = adr;
     95          
     96            cnt = len / sizeof(uint32_t);
     97            for (i = 0U; i < cnt; i++) {
     98              if (*dat != 0xFFFFFFFFUL) {
     99                return false;
    100              }
    101              dat++;
    102            }
    103          
    104            return true;
    105          }
    106          
    107          /** @endcond */
    108          

   \                                 In section .text, align 2, keep-with-next
    109          static Ecode_t nvm3_halFlashOpen(nvm3_HalPtr_t nvmAdr, size_t flashSize)
    110          {
   \                     nvm3_halFlashOpen: (+1)
   \        0x0   0xB580             PUSH     {R7,LR}
    111            (void)nvmAdr;
    112            (void)flashSize;
    113            MSC_Init();
   \        0x2   0x....'....        BL       MSC_Init
    114          
    115            return ECODE_NVM3_OK;
   \        0x6   0x2000             MOVS     R0,#+0
   \        0x8   0xBD02             POP      {R1,PC}          ;; return
    116          }
    117          

   \                                 In section .text, align 2, keep-with-next
    118          static void nvm3_halFlashClose(void)
    119          {
    120            MSC_Deinit();
   \                     nvm3_halFlashClose: (+1)
   \        0x0   0x....'....        B.W      MSC_Deinit
    121          }
    122          

   \                                 In section .text, align 2, keep-with-next
    123          static Ecode_t nvm3_halFlashGetInfo(nvm3_HalInfo_t *halInfo)
    124          {
   \                     nvm3_halFlashGetInfo: (+1)
   \        0x0   0xB51C             PUSH     {R2-R4,LR}
   \        0x2   0x4604             MOV      R4,R0
    125            SYSTEM_ChipRevision_TypeDef chipRev;
    126          
    127            SYSTEM_ChipRevisionGet(&chipRev);
   \        0x4   0x4668             MOV      R0,SP
   \        0x6   0x....'....        BL       SYSTEM_ChipRevisionGet
    128            halInfo->deviceFamily = chipRev.family;
   \        0xA   0xF89D 0x0002      LDRB     R0,[SP, #+2]
    129            halInfo->memoryMapped = 1;
   \        0xE   0x2101             MOVS     R1,#+1
    130          #if defined(_SILICON_LABS_32B_SERIES_2)
    131            halInfo->writeSize = NVM3_HAL_WRITE_SIZE_32;
   \       0x10   0x2200             MOVS     R2,#+0
   \       0x12   0x8020             STRH     R0,[R4, #+0]
   \       0x14   0x70E1             STRB     R1,[R4, #+3]
   \       0x16   0x70A2             STRB     R2,[R4, #+2]
    132          #else
    133            halInfo->writeSize = NVM3_HAL_WRITE_SIZE_16;
    134          #endif
    135            halInfo->pageSize = SYSTEM_GetFlashPageSize();
   \       0x18   0x....             LDR.N    R1,??DataTable3_2  ;; 0xfe08008
   \       0x1A   0x6808             LDR      R0,[R1, #+0]
   \       0x1C   0x2201             MOVS     R2,#+1
   \       0x1E   0x300A             ADDS     R0,R0,#+10
   \       0x20   0xF000 0x001F      AND      R0,R0,#0x1F
   \       0x24   0xFA02 0xF000      LSL      R0,R2,R0
   \       0x28   0x6060             STR      R0,[R4, #+4]
    136            halInfo->systemUnique = SYSTEM_GetUnique();
   \       0x2A   0x6C08             LDR      R0,[R1, #+64]
   \       0x2C   0x6C49             LDR      R1,[R1, #+68]
   \       0x2E   0xE9C4 0x0102      STRD     R0,R1,[R4, #+8]
    137          
    138            return ECODE_NVM3_OK;
   \       0x32   0x2000             MOVS     R0,#+0
   \       0x34   0xBD16             POP      {R1,R2,R4,PC}    ;; return
    139          }
    140          

   \                                 In section .text, align 2, keep-with-next
    141          static void nvm3_halFlashAccess(nvm3_HalNvmAccessCode_t access)
    142          {
    143            (void)access;
    144          }
   \                     nvm3_halFlashAccess: (+1)
   \        0x0   0x4770             BX       LR               ;; return
    145          

   \                                 In section .text, align 2, keep-with-next
    146          Ecode_t nvm3_halFlashReadWords(nvm3_HalPtr_t nvmAdr, void *dst, size_t wordCnt)
    147          {
    148            uint32_t *pSrc = (uint32_t *)nvmAdr;
    149            uint32_t *pDst = dst;
   \                     nvm3_halFlashReadWords: (+1)
   \        0x0   0x2A00             CMP      R2,#+0
   \        0x2   0xE004             B.N      ??nvm3_halFlashReadWords_0
    150          
    151            while (wordCnt > 0U) {
    152              *pDst++ = *pSrc++;
   \                     ??nvm3_halFlashReadWords_1: (+1)
   \        0x4   0xF850 0x3B04      LDR      R3,[R0], #+4
    153              wordCnt--;
   \        0x8   0x1E52             SUBS     R2,R2,#+1
   \        0xA   0xF841 0x3B04      STR      R3,[R1], #+4
    154            }
   \                     ??nvm3_halFlashReadWords_0: (+1)
   \        0xE   0xD1F9             BNE.N    ??nvm3_halFlashReadWords_1
    155          
    156            return ECODE_NVM3_OK;
   \       0x10   0x2000             MOVS     R0,#+0
   \       0x12   0x4770             BX       LR               ;; return
    157          }
    158          

   \                                 In section .text, align 2, keep-with-next
    159          static Ecode_t nvm3_halFlashWriteWords(nvm3_HalPtr_t nvmAdr, void const *src, size_t wordCnt)
    160          {
   \                     nvm3_halFlashWriteWords: (+1)
   \        0x0   0xB5F8             PUSH     {R3-R7,LR}
    161            const uint32_t *pSrc = src;
    162            uint32_t *pDst = (uint32_t *)nvmAdr;
    163            MSC_Status_TypeDef mscSta;
    164            Ecode_t halSta;
    165            size_t byteCnt;
    166          
    167            byteCnt = wordCnt * sizeof(uint32_t);
   \        0x2   0x0097             LSLS     R7,R2,#+2
   \        0x4   0x4605             MOV      R5,R0
   \        0x6   0x460E             MOV      R6,R1
    168            mscSta = MSC_WriteWord(pDst, pSrc, byteCnt);
   \        0x8   0x463A             MOV      R2,R7
   \        0xA   0x....'....        BL       MSC_WriteWord
    169            halSta = convertMscStatusToNvm3Status(mscSta);
   \        0xE   0x....'....        BL       convertMscStatusToNvm3Status
   \       0x12   0x0004             MOVS     R4,R0
    170          
    171          #if CHECK_DATA
    172            if (halSta == ECODE_NVM3_OK) {
   \       0x14   0xD106             BNE.N    ??nvm3_halFlashWriteWords_0
    173              if (memcmp(pDst, pSrc, byteCnt) != 0) {
   \       0x16   0x463A             MOV      R2,R7
   \       0x18   0x4631             MOV      R1,R6
   \       0x1A   0x4628             MOV      R0,R5
   \       0x1C   0x....'....        BL       memcmp
   \       0x20   0xB100             CBZ.N    R0,??nvm3_halFlashWriteWords_0
    174                halSta = ECODE_NVM3_ERR_WRITE_FAILED;
   \       0x22   0x....             LDR.N    R4,??DataTable3_3  ;; 0xf000e010
    175              }
    176            }
    177          #endif
    178          
    179            return halSta;
   \                     ??nvm3_halFlashWriteWords_0: (+1)
   \       0x24   0x4620             MOV      R0,R4
   \       0x26   0xBDF2             POP      {R1,R4-R7,PC}    ;; return
    180          }
    181          

   \                                 In section .text, align 2, keep-with-next
    182          static Ecode_t nvm3_halFlashPageErase(nvm3_HalPtr_t nvmAdr)
    183          {
   \                     nvm3_halFlashPageErase: (+1)
   \        0x0   0xB510             PUSH     {R4,LR}
   \        0x2   0x4604             MOV      R4,R0
    184            MSC_Status_TypeDef mscSta;
    185            Ecode_t halSta;
    186          
    187            mscSta = MSC_ErasePage((uint32_t *)nvmAdr);
   \        0x4   0x....'....        BL       MSC_ErasePage
    188            halSta = convertMscStatusToNvm3Status(mscSta);
   \        0x8   0x....'....        BL       convertMscStatusToNvm3Status
    189          
    190          #if CHECK_DATA
    191            if (halSta == ECODE_NVM3_OK) {
   \        0xC   0xB998             CBNZ.N   R0,??nvm3_halFlashPageErase_0
    192              if (!isErased(nvmAdr, SYSTEM_GetFlashPageSize())) {
   \        0xE   0x....             LDR.N    R1,??DataTable3_2  ;; 0xfe08008
   \       0x10   0x6809             LDR      R1,[R1, #+0]
   \       0x12   0x2201             MOVS     R2,#+1
   \       0x14   0x310A             ADDS     R1,R1,#+10
   \       0x16   0xF001 0x011F      AND      R1,R1,#0x1F
   \       0x1A   0xFA02 0xF101      LSL      R1,R2,R1
   \       0x1E   0x2200             MOVS     R2,#+0
   \       0x20   0xE000             B.N      ??nvm3_halFlashPageErase_1
   \                     ??nvm3_halFlashPageErase_2: (+1)
   \       0x22   0x1C52             ADDS     R2,R2,#+1
   \                     ??nvm3_halFlashPageErase_1: (+1)
   \       0x24   0xEBB2 0x0F91      CMP      R2,R1, LSR #+2
   \       0x28   0xD205             BCS.N    ??nvm3_halFlashPageErase_0
   \       0x2A   0xF854 0x3B04      LDR      R3,[R4], #+4
   \       0x2E   0xF113 0x0F01      CMN      R3,#+1
   \       0x32   0xD0F6             BEQ.N    ??nvm3_halFlashPageErase_2
    193                halSta = ECODE_NVM3_ERR_ERASE_FAILED;
   \       0x34   0x....             LDR.N    R0,??DataTable3_4  ;; 0xf000e00e
    194              }
    195            }
    196          #endif
    197          
    198            return halSta;
   \                     ??nvm3_halFlashPageErase_0: (+1)
   \       0x36   0xBD10             POP      {R4,PC}          ;; return
    199          }
    200          
    201          /*******************************************************************************
    202           ***************************   GLOBAL VARIABLES   ******************************
    203           ******************************************************************************/
    204          

   \                                 In section .rodata, align 4
    205          const nvm3_HalHandle_t nvm3_halFlashHandle = {
   \                     nvm3_halFlashHandle:
   \        0x0   0x....'....        DC32 nvm3_halFlashOpen, nvm3_halFlashClose, nvm3_halFlashGetInfo
   \              0x....'....  
   \              0x....'....  
   \        0xC   0x....'....        DC32 nvm3_halFlashAccess, nvm3_halFlashPageErase
   \              0x....'....  
   \       0x14   0x....'....        DC32 nvm3_halFlashReadWords, nvm3_halFlashWriteWords
   \              0x....'....  

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable3:
   \        0x0   0xF000'E021        DC32     0xf000e021

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable3_1:
   \        0x0   0xF000'E024        DC32     0xf000e024

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable3_2:
   \        0x0   0x0FE0'8008        DC32     0xfe08008

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable3_3:
   \        0x0   0xF000'E010        DC32     0xf000e010

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable3_4:
   \        0x0   0xF000'E00E        DC32     0xf000e00e
    206            .open = nvm3_halFlashOpen,
    207            .close = nvm3_halFlashClose,
    208            .getInfo = nvm3_halFlashGetInfo,
    209            .access = nvm3_halFlashAccess,
    210            .pageErase = nvm3_halFlashPageErase,
    211            .readWords = nvm3_halFlashReadWords,
    212            .writeWords = nvm3_halFlashWriteWords,
    213          };
    214          
    215          /** @} (end addtogroup NVM3Hal) */
    216          /** @} (end addtogroup NVM3) */
    217          /** @} (end addtogroup emdrv) */

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       0   convertMscStatusToNvm3Status
       0   nvm3_halFlashAccess
       0   nvm3_halFlashClose
         0   -> MSC_Deinit
      16   nvm3_halFlashGetInfo
        16   -> SYSTEM_ChipRevisionGet
       8   nvm3_halFlashOpen
         8   -> MSC_Init
       8   nvm3_halFlashPageErase
         8   -> MSC_ErasePage
         8   -> convertMscStatusToNvm3Status
       0   nvm3_halFlashReadWords
      24   nvm3_halFlashWriteWords
        24   -> MSC_WriteWord
        24   -> convertMscStatusToNvm3Status
        24   -> memcmp


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable3
       4  ??DataTable3_1
       4  ??DataTable3_2
       4  ??DataTable3_3
       4  ??DataTable3_4
      16  convertMscStatusToNvm3Status
       2  nvm3_halFlashAccess
       4  nvm3_halFlashClose
      54  nvm3_halFlashGetInfo
      28  nvm3_halFlashHandle
      10  nvm3_halFlashOpen
      56  nvm3_halFlashPageErase
      20  nvm3_halFlashReadWords
      40  nvm3_halFlashWriteWords

 
  28 bytes in section .rodata
 222 bytes in section .text
 
 222 bytes of CODE  memory
  28 bytes of CONST memory

Errors: none
Warnings: none
